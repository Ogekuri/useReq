# WORKFLOW

- Feature: Documentation maintenance and comment conformance
  - Module: `src/usereq/*.py`
    - `module/class/function docstrings`: structured Doxygen normalization for parser-safe metadata extraction [`src/usereq/*.py`]
      - description: each Python module/class/function docstring is normalized to include `@brief` blocks to maintain machine-interpretable documentation consistency without altering runtime behavior or call order.

- Feature: CLI bootstrap and command dispatch
  - Module: `src/usereq/__main__.py`
    - `main()`: module execution entrypoint forwarding process exit code [`src/usereq/__main__.py:L1-L7`]
      - description: imports `cli.main`, invokes it when executed as module, and returns its integer status through `sys.exit`.
      - `main()`: centralized command router for all operational modes [`src/usereq/cli.py:L2141-L2192`]
        - description: parses argv, dispatches precedence chain (`--uninstall` -> `--upgrade` -> `--version` -> standalone file commands -> project scan commands -> initialization), maps domain errors to stable non-zero exit codes via `ReqError`.
        - `run_uninstall()`: delegates package removal to uv [`src/usereq/cli.py:L260-L277`]
          - description: executes `uv tool uninstall usereq` using subprocess; raises `ReqError` for missing executable or non-zero return.
        - `run_upgrade()`: delegates package upgrade to uv git source [`src/usereq/cli.py:L238-L257`]
          - description: executes `uv tool install usereq --force --from git+https://github.com/Ogekuri/useReq.git`; propagates failures as `ReqError`.
        - `maybe_print_version()`: handles explicit version query [`src/usereq/cli.py:L230-L235`]
          - description: checks `--ver`/`--version`, prints value from `load_package_version()`, short-circuits command flow.
        - `parse_args()`: builds namespace from parser spec [`src/usereq/cli.py:L236-L239`]
          - description: wraps `build_parser().parse_args`, ensuring option set includes initialization, provider generation, update/remove, standalone file analysis/compression/token counting, and `--enable-line-numbers` routing for compression and construct extraction commands.
        - `_is_standalone_command()`: identifies file-list execution mode [`src/usereq/cli.py:L2032-L2038`]
          - description: returns true if any of `--files-tokens`, `--files-references`, `--files-compress`, `--files-find` is set.
        - `_is_project_scan_command()`: identifies project source scan mode [`src/usereq/cli.py:L2041-L2046`]
          - description: returns true if `--references`, `--compress`, `--tokens`, or `--find` is set.

- Feature: Project initialization/update and provider resource generation
  - Module: `src/usereq/cli.py`
    - `run()`: orchestrates validation, config normalization, token substitution, and artifact emission [`src/usereq/cli.py:L1186-L1989`]
      - description: validates mutually exclusive flags and required directories, normalizes/guards project-relative paths, loads persisted configuration for `--update` and for `--here` (with explicit path flags ignored in `--here` mode), performs version check and then writes project resources (`.req`, provider prompts/agents, docs, VS Code settings), finally emits installation report.
      - `run_remove()`: alternate flow when `--remove` is active [`src/usereq/cli.py:L1145-L1184`]
        - description: validates incompatible flags, verifies `.req/config.json`, ignores explicit path flags in `--here` mode, executes online version notice check, removes generated resources and prunes empty provider directories.
      - `load_config()`: reads persisted initialization parameters [`src/usereq/cli.py:L502-L536`]
        - description: loads `.req/config.json`, validates schema (`guidelines-dir`, `docs-dir`, `tests-dir`, `src-dir` list), supports legacy key aliases.
      - `ensure_doc_directory()`: validates docs directory constraints [`src/usereq/cli.py:L366-L380`]
        - description: normalizes candidate path and rejects non-directory/nonexistent/out-of-project values.
      - `ensure_test_directory()`: validates tests directory constraints [`src/usereq/cli.py:L382-L396`]
        - description: applies same guardrail policy as docs directory for tests path.
      - `ensure_src_directory()`: validates each source directory constraint [`src/usereq/cli.py:L398-L412`]
        - description: enforces existence, directory type, and containment under project base per source root.
      - `make_relative_if_contains_project()`: canonicalizes incoming path forms [`src/usereq/cli.py:L414-L447`]
        - description: converts absolute/project-prefixed paths to project-relative tokens while preserving fallback behavior for non-relativizable inputs.
      - `save_config()`: persists normalized config in `.req/config.json` [`src/usereq/cli.py:L481-L500`]
        - description: serializes effective directories (including repeated `src-dir`) after path normalization and validation.
      - `maybe_notify_newer_version()`: performs remote version probe [`src/usereq/cli.py:L324-L363`]
        - description: sends HTTP GET to GitHub releases API, parses JSON `tag_name`, compares with local version using `normalize_release_tag()`, `parse_version_tuple()`, and `is_newer_version()`, prints upgrade hint when newer release exists.
      - `upgrade_guidelines_templates()`: optionally copies packaged guideline templates [`src/usereq/cli.py:L658-L689`]
        - description: copies non-hidden files from `resources/guidelines` to user guidelines directory, honoring overwrite behavior for `--upgrade-guidelines` vs `--add-guidelines`; when source directory is empty, returns zero copied files without error.
      - `generate_guidelines_file_list()`: computes token replacement for guideline inventory [`src/usereq/cli.py:L539-L564`]
        - description: scans non-hidden files at guideline root, emits inline-code relative paths, falls back to directory token when empty.
      - `list_docs_templates()`: resolves runtime docs template inventory [`src/usereq/cli.py:L914-L927`]
        - description: enumerates non-hidden files in `resources/docs`, enforcing non-empty availability for downstream copy and generation flows.
      - `find_requirements_template()`: resolves requirements template location [`src/usereq/cli.py:L930-L942`]
        - description: selects `Requirements_Template.md` from runtime docs template inventory and fails fast when absent.
      - `load_kiro_template()`: resolves Kiro agent template from centralized models config [`src/usereq/cli.py:L854-L885`]
        - description: loads `models.json` or `models-legacy.json`, extracts `kiro.agent_template` string/object payload, errors on missing template.
      - `load_centralized_models()`: loads provider model/tool metadata [`src/usereq/cli.py:L919-L967`]
        - description: chooses source config by precedence (`.req/models.json` preserve path > legacy file > default file), parses JSON/JSONC via `load_settings()`, returns CLI-specific configuration map.
      - `extract_frontmatter()`: splits prompt metadata/body [`src/usereq/cli.py:L716-L723`]
        - description: enforces leading YAML frontmatter block for every prompt template.
      - `extract_description()`: extracts prompt description field [`src/usereq/cli.py:L725-L730`]
        - description: parses `description:` from frontmatter and normalizes escaping.
      - `extract_argument_hint()`: extracts optional argument metadata [`src/usereq/cli.py:L733-L738`]
        - description: returns normalized `argument-hint` value used by prompt command frontmatter.
      - `apply_replacements()`: applies path token substitutions [`src/usereq/cli.py:L656-L660`]
        - description: replaces `%%GUIDELINES_FILES%%`, `%%GUIDELINES_PATH%%`, `%%DOC_PATH%%`, `%%TEST_PATH%%`, and `%%SRC_PATHS%%` placeholders in prompt content.
      - `md_to_toml()`: converts markdown prompt into Gemini TOML [`src/usereq/cli.py:L688-L713`]
        - description: parses frontmatter/body, writes TOML with description and multiline prompt block, then provider-specific token replacement occurs via `replace_tokens()`.
      - `render_kiro_agent()`: materializes Kiro JSON agent [`src/usereq/cli.py:L788-L827`]
        - description: injects escaped template fields (`name`, `description`, `prompt`, `resources`) and conditionally includes `model` and tool lists; returns parsed JSON pretty format.
      - `write_text_file()`: common file emission helper [`src/usereq/cli.py:L663-L667`]
        - description: ensures parent directories and writes UTF-8 text, used by multiple provider emitters.
      - `deep_merge_dict()`: merges VS Code settings recursively [`src/usereq/cli.py:L1035-L1042`]
        - description: deep-merges template settings into existing settings with incoming precedence; used before writing `.vscode/settings.json`.
      - `build_prompt_recommendations()`: computes prompt recommendation map [`src/usereq/cli.py:L1053-L1060`]
        - description: builds `chat.promptFilesRecommendations` entries from prompt template filenames.

- Feature: Standalone and project source-file command workflows
  - Module: `src/usereq/cli.py`
    - `run_files_tokens()`: token metrics for explicit file lists [`src/usereq/cli.py:L2049-L2065`]
      - description: filters existing files, computes metrics through `count_files_metrics()`, formats report via `format_pack_summary()`, errors when no valid files remain.
      - `count_files_metrics()`: computes per-file token/char metrics [`src/usereq/token_counter.py:L45-L70`]
        - description: reads each file, counts tokens through shared encoder instance, captures read/parse errors as structured metric rows.
      - `format_pack_summary()`: emits aggregate text summary [`src/usereq/token_counter.py:L73-L104`]
        - description: accumulates totals and per-file status lines (ok/error) for stdout reporting.
    - `run_files_references()`: markdown references for explicit file lists [`src/usereq/cli.py:L2197-L2203`]
      - description: delegates to `generate_markdown()` passing `verbose=VERBOSE` and prints concatenated analysis output.
      - `generate_markdown()`: file-wise analysis and markdown concatenation [`src/usereq/generate_markdown.py:L46-L95`]
        - description: validates file existence and supported extension via `detect_language()`, executes `SourceAnalyzer.analyze()` + `SourceAnalyzer.enrich()`, computes total line count, emits markdown via `format_markdown()`, joins outputs with `---` separator, and emits SKIP/OK/FAIL and summary status on stderr only when `verbose=True`.
    - `run_files_compress()`: compressed output for explicit file lists [`src/usereq/cli.py:L2206-L2219`]
      - description: delegates to `compress_files()` and prints concatenated compressed payload; maps CLI flag `--enable-line-numbers` to `include_line_numbers=True` and keeps line numbers disabled by default.
      - `compress_files()`: compresses and concatenates file blocks [`src/usereq/compress_files.py:L30-L80`]
        - description: validates each path/language, applies `compress_file()`, derives line interval from preserved `<n>:` markers via `_extract_line_range()`, emits each file block as `@@@ <path> | <lang>` + `- Lines: <start>-<end>` + triple-backtick fenced code payload, tracks ok/fail counters, errors if no valid file processed, and emits SKIP/OK/FAIL and summary status on stderr only when `verbose=True`.
        - `compress_file()`: reads single file and delegates normalization/compression [`src/usereq/compress.py:L320-L343`]
          - description: auto-detects language when not provided, reads source text, invokes `compress_source()`.
          - `compress_source()`: comment-aware source minimization pipeline [`src/usereq/compress.py:L148-L317`]
            - description: removes full-line and inline comments while preserving string literals, handles multiline comments/docstrings statefully, preserves indentation for indentation-sensitive languages, strips blank/trailing whitespace, and formats optional line-number prefixes.
    - `run_files_find()`: construct extraction for explicit file lists [`src/usereq/cli.py:L2222-L2243`]
      - description: validates minimum argument count (TAG, PATTERN, FILE), imports `format_available_tags()` to include available TAG listing in error messages when insufficient arguments provided, parses TAG and PATTERN from arguments, delegates to `find_constructs_in_files()` with remaining file paths, maps CLI flag `--enable-line-numbers` to `include_line_numbers=True` while keeping default output without line prefixes, forwards `verbose=VERBOSE`, catches `ValueError` exceptions and re-raises as `ReqError` with full error message including available TAG listing.
      - `_get_available_tags_help()`: generates TAG listing for CLI help text [`src/usereq/cli.py:L65-L75`]
        - description: attempts to import `format_available_tags()` from `find_constructs` module to generate dynamic TAG listing for argument parser help display, returns fallback message if import fails.
      - `find_constructs_in_files()`: filters and extracts matching constructs [`src/usereq/find_constructs.py:L118-L198`]
        - description: parses pipe-separated tags via `parse_tag_filter()`, validates tag set is non-empty and raises `ValueError` with `format_available_tags()` output when empty, validates language-tag compatibility via `language_supports_tags()`, analyzes each file with `SourceAnalyzer.analyze()` + `SourceAnalyzer.enrich()`, filters elements via `construct_matches()` for tag and regex pattern, formats output with `format_construct()`, prefixes each file with `@@@ <path> | <lang>`, tracks match/skip/fail counters, errors with `format_available_tags()` output if no constructs found, and emits SKIP/OK/FAIL and summary status on stderr only when `verbose=True`.
        - `format_available_tags()`: generates formatted TAG listing per language [`src/usereq/find_constructs.py:L40-L51`]
          - description: iterates `LANGUAGE_TAGS` dictionary in sorted key order, sorts each language's tag set alphabetically, capitalizes language name, formats each entry as `- Language: TAG1, TAG2, ...` with comma-space separation, returns multi-line string for error messages and help text display.
        - `parse_tag_filter()`: parses pipe-separated TAG string into normalized set [`src/usereq/find_constructs.py:L54-L59`]
          - description: splits on `|`, strips whitespace, uppercases identifiers.
        - `language_supports_tags()`: validates language-tag compatibility [`src/usereq/find_constructs.py`]
          - description: checks intersection of requested tags with language-specific supported tags from `LANGUAGE_TAGS` map.
        - `construct_matches()`: filters element by type and name pattern [`src/usereq/find_constructs.py`]
          - description: tests if element type is in tag set and element name matches regex via `re.search()`.
        - `format_construct()`: formats matched construct as markdown block [`src/usereq/find_constructs.py:L89-L115`]
          - description: receives SourceElement instance and complete source file lines list, extracts complete construct code from source_lines using element.line_start and element.line_end indices (replacing truncated element.extract field), emits type, name, signature, line range, and full construct code with optional `<n>:` line number prefixes.
    - `run_references()`: project-wide markdown references [`src/usereq/cli.py:L2247-L2258`]
      - description: resolves project source roots with `_resolve_project_src_dirs()`, recursively enumerates source files through `_collect_source_files()`, builds `# Files Structure` fenced tree through `_format_files_structure_markdown()`, then appends markdown from `generate_markdown(verbose=VERBOSE)`.
      - `_format_files_structure_markdown()`: renders markdown wrapper for scanned source tree [`src/usereq/cli.py`]
        - description: normalizes absolute scanned files to project-relative paths and emits a deterministic code-fenced tree section headed by `# Files Structure`.
        - `_build_ascii_tree()`: deterministic ASCII tree renderer for relative paths [`src/usereq/cli.py`]
          - description: materializes a nested path trie and renders `.`-rooted branch connectors (`├──`, `└──`) in lexical order for parser-stable output.
    - `run_compress_cmd()`: project-wide compression [`src/usereq/cli.py:L2261-L2275`]
      - description: shares `_resolve_project_src_dirs()` + `_collect_source_files()` path and invokes `compress_files()` with `include_line_numbers` derived from `--enable-line-numbers` and `verbose=VERBOSE`.
    - `run_find()`: project-wide construct extraction [`src/usereq/cli.py:L2278-L2302`]
      - description: resolves project source roots and files via `_resolve_project_src_dirs()` + `_collect_source_files()`, extracts TAG and PATTERN from `args.find`, delegates to `find_constructs_in_files()` with `include_line_numbers` derived from `--enable-line-numbers` and `verbose=VERBOSE`, catches `ValueError` exceptions and re-raises as `ReqError` with full error message including available TAG listing from `format_available_tags()`.
    - `run_tokens()`: project docs token metrics [`src/usereq/cli.py:L2112-L2129`]
      - description: resolves project base through `_resolve_project_base()`, uses `docs-dir` from `.req/config.json` when `--here` is active (ignoring explicit `--docs-dir`) otherwise validates explicit `--docs-dir` through `ensure_doc_directory()`, enumerates regular files directly under docs path, and delegates token report emission to `run_files_tokens()`.
    - `_resolve_project_base()`: resolves execution base for project-scope commands [`src/usereq/cli.py:L2132-L2150`]
      - description: enforces `--base` or `--here`, resolves absolute root path, and validates path existence for `--references`, `--compress`, and `--tokens`.
    - `_resolve_project_src_dirs()`: derives source roots from args or config [`src/usereq/cli.py:L2153-L2172`]
      - description: reuses `_resolve_project_base()`, loads configured `src-dir` from `.req/config.json` when `--here` is active (ignoring explicit `--src-dir`) and otherwise uses explicit `--src-dir` with config fallback, validates non-empty source root set.
    - `_collect_source_files()`: recursive source discovery with exclusion filters [`src/usereq/cli.py:L2010-L2029`]
      - description: walks each source root, prunes `EXCLUDED_DIRS`, keeps files with `SUPPORTED_EXTENSIONS`, and returns deterministic sorted path list.

- Feature: Source analysis and markdown rendering engine
  - Module: `src/usereq/source_analyzer.py`
    - `SourceAnalyzer.analyze()`: lexical-pattern extraction of code elements [`src/usereq/source_analyzer.py:L690-L836`]
      - description: normalizes language key, loads file lines, tracks multiline/single comments while avoiding string literal false-positives, matches per-language regex patterns from `LanguageSpec.patterns`, computes block ranges via `_find_block_end()`, and returns `SourceElement` entries.
      - `build_language_specs()`: language-specific regex precedence matrix [`src/usereq/source_analyzer.py:L109-L650`]
        - description: defines per-language ordered match precedence; Perl evaluates `CONSTANT` before `IMPORT` to keep `use constant` classified as constants, Zig evaluates `IMPORT` before generic `CONSTANT` to classify `@import` bindings correctly, Elixir `STRUCT` captures the full `defstruct` payload to preserve distinct struct identifiers across fixtures.
      - `_find_comment()`: locates effective single-line comment start [`src/usereq/source_analyzer.py:L867-L900`]
        - description: scans line while maintaining string delimiter state to avoid comment delimiters inside literals.
      - `_find_block_end()`: language-family block boundary detection [`src/usereq/source_analyzer.py:L901-L975`]
        - description: applies indentation strategy for Python/Haskell, brace matching for brace languages, and `end`-keyword strategy for Ruby/Elixir/Lua.
    - `SourceAnalyzer.enrich()`: metadata enrichment pass [`src/usereq/source_analyzer.py:L979-L996`]
      - description: sequentially enriches extracted elements with clean names, signatures, hierarchy depth, visibility, inheritance, and optional body comments/exit points.
      - `_extract_body_annotations()`: scans definition bodies for comment and exit semantics [`src/usereq/source_analyzer.py:L1181-L1310`]
        - description: re-reads full file and stores normalized body comment spans plus control-flow exits (`return`, `raise`, `throw`, `panic!`, process exits) per definition.
    - `format_markdown()`: compact LLM-optimized markdown formatter [`src/usereq/source_analyzer.py:L1642-L1894`]
      - description: emits header/imports/definitions/comments/symbol-index sections, utilizing Markdown tables for definitions and symbol index to maximize token efficiency, maps nearby doc comments to definitions via `_build_comment_maps()`, renders child definitions and body annotations with line-local traceability.
      - `_build_comment_maps()`: associates comments with nearest definitions [`src/usereq/source_analyzer.py:L1520-L1583`]
        - description: builds adjacency map for preceding comments, standalone comments, and file-level description signal.
      - `_render_body_annotations()`: emits ordered body comment/exit annotations [`src/usereq/source_analyzer.py:L1586-L1640`]
        - description: merges comment and exit signals by line, excludes child ranges for parent containers, and outputs normalized line markers.

- Feature: CI/CD release automation
  - Module: `.github/workflows/release-uvx.yml`
    - `build-release` job: tag-triggered build and release pipeline [`.github/workflows/release-uvx.yml:L1-L48`]
      - description: on `push` tags `v*`, workflow checks out repository, sets Python+uv, installs build dependencies from `requirements.txt`, builds distributions (`python -m build`), attests provenance for `dist/*`, and creates GitHub release uploading built artifacts.

- Cross-cutting common logic and side-effect map
  - Module: Shared utility functions in `src/usereq/cli.py`
    - `load_settings()`: JSON+JSONC loader [`src/usereq/cli.py:L908-L917`]
      - description: parses strict JSON first, then retries after `strip_json_comments()` cleanup for JSONC-like files.
    - `ensure_wrapped()`: deletion safety boundary check [`src/usereq/cli.py:L1063-L1070`]
      - description: guards destructive operations by requiring target path to remain within resolved project root.
    - `prune_empty_dirs()`: provider directory cleanup [`src/usereq/cli.py:L1092-L1103`]
      - description: post-order traversal removing empty folders after removal workflow.

- I/O boundary inventory
  - Filesystem read operations
    - `Path.read_text()` / `open(..., 'r')` in config/template/prompt/model/settings/source loading across `cli.py`, `generate_markdown.py`, `compress.py`, `token_counter.py`, `source_analyzer.py`.
  - Filesystem write operations
    - `Path.write_text()`, `shutil.copyfile()`, `shutil.copytree()`, `mkdir()`, `unlink()`, `rmtree()` in initialization/update/remove flows (`src/usereq/cli.py:L481-L500`, `L1105-L1143`, `L1311-L1928`), plus generated output writers in `compress_files.py` and markdown/compress CLIs (stdout).
  - External API calls
    - GitHub Releases API HTTP GET: `https://api.github.com/repos/Ogekuri/useReq/releases/latest` via `urllib.request.urlopen` in `maybe_notify_newer_version()` (`src/usereq/cli.py:L331-L363`).
  - External process execution
    - `subprocess.run()` for `uv tool install/uninstall` and pdoc invocation (`src/usereq/cli.py:L238-L277`, `src/usereq/pdoc_utils.py:L19-L84`).
  - External database access
    - No database client usage or DB connection logic detected in analyzed modules.

- Feature: Comprehensive construct extraction testing
  - Module: `tests/test_find_constructs_comprehensive.py`
    - `TestFindConstructsComprehensive`: comprehensive test suite validating construct extraction across all languages [`tests/test_find_constructs_comprehensive.py:L319-L737`]
      - description: validates find_constructs_in_files() for all language-construct combinations defined in FND-002, using fixture files to ensure correct extraction of constructs by tag filter and regex pattern.
      - `test_language_tags_coverage()`: verifies EXPECTED_CONSTRUCTS covers all 20 supported languages [`tests/test_find_constructs_comprehensive.py:L358-L364`]
        - description: ensures test coverage completeness by comparing required languages from LANGUAGE_TAGS against covered languages in EXPECTED_CONSTRUCTS dictionary.
      - `test_fixture_exists()`: parametrized test verifying fixture file existence for each language [`tests/test_find_constructs_comprehensive.py:L366-L372`]
        - description: ensures all 20 language fixtures exist in tests/fixtures/ directory using get_fixture_path() resolution.
      - `test_fixture_has_minimum_five_constructs_per_tag()`: validates quantitative fixture density per TAG [`tests/test_find_constructs_comprehensive.py`]
        - description: analyzes each fixture with `SourceAnalyzer.analyze()` + `SourceAnalyzer.enrich()`, groups extracted names by `ElementType`, and asserts at least five distinct constructs for every tag required by `LANGUAGE_TAGS[language]` (FND-014).
      - `test_extracts_five_distinct_construct_versions_per_tag()`: validates five extraction executions per language/tag [`tests/test_find_constructs_comprehensive.py`]
        - description: for each `(language, tag)` pair in `LANGUAGE_TAGS`, computes distinct construct names from fixture analysis, enforces minimum cardinality `>=5`, then executes `find_constructs_in_files()` five times using anchored regex (`^<escaped_name>$`) and verifies tagged construct presence in each extraction output (REQ-100).
      - `test_python_class_extraction()`: validates CLASS construct extraction from Python fixture [`tests/test_find_constructs_comprehensive.py:L376-L382`]
        - description: extracts all CLASS constructs from Python fixture and verifies presence of expected classes defined in EXPECTED_CONSTRUCTS mapping.
      - `test_python_function_extraction()`: validates FUNCTION construct extraction from Python fixture [`tests/test_find_constructs_comprehensive.py:L384-L392`]
        - description: extracts FUNCTION constructs and verifies subset of key functions including async_function and generator_function.
      - `test_c_struct_extraction()`: validates STRUCT construct extraction from C fixture [`tests/test_find_constructs_comprehensive.py:L410-L416`]
        - description: extracts all STRUCT constructs and verifies presence of expected struct definitions.
      - `test_rust_trait_extraction()`: validates TRAIT construct extraction from Rust fixture [`tests/test_find_constructs_comprehensive.py:L439-L445`]
        - description: extracts TRAIT constructs and verifies presence of MyTrait and Parser trait definitions.
      - `test_pattern_matching_case_sensitive()`: validates case-sensitive regex pattern matching [`tests/test_find_constructs_comprehensive.py:L512-L518`]
        - description: tests anchored regex patterns to ensure exact matching without false positives from partial name matches.
      - `test_multiple_tags_extraction()`: validates extraction with pipe-separated multiple tag filter [`tests/test_find_constructs_comprehensive.py:L528-L533`]
        - description: extracts constructs matching multiple types (CLASS|FUNCTION) with pattern filter to verify tag union semantics.

- Requirements alignment evidence (`docs/REQUIREMENTS.md`)
  - CLI routing and options align with REQ-001..REQ-015 and CMD-001..CMD-014 (`docs/REQUIREMENTS.md:L232-L434`; `src/usereq/cli.py:L57-L217`, `L2032-L2175`).
  - Version check flow aligns with REQ-016..REQ-017 (`docs/REQUIREMENTS.md:L259-L263`; `src/usereq/cli.py:L324-L363`).
  - Initialization/config/resource generation aligns with REQ-018..REQ-074, REQ-082..REQ-096 (`docs/REQUIREMENTS.md:L264-L350`; `src/usereq/cli.py:L1186-L1989`).
  - Source analyzer, token, markdown, compression capabilities align with SRC-001..SRC-014, TOK-001..TOK-006, MKD-001..MKD-007, CMP-001..CMP-012 (`docs/REQUIREMENTS.md:L365-L415`; `src/usereq/source_analyzer.py`, `token_counter.py`, `generate_markdown.py`, `compress.py`, `compress_files.py`).
  - Construct extraction and comprehensive testing align with FND-001..FND-014, CMD-018..CMD-028, REQ-100 (`docs/REQUIREMENTS.md:L456-L487`; `src/usereq/find_constructs.py`, `tests/test_find_constructs_comprehensive.py`).
  - Documentation standards align with DOC-001..DOC-003 (`docs/REQUIREMENTS.md`; `src/usereq/*.py` Doxygen headers and docstrings).
  - CI workflow aligns with REQ-078..REQ-081 (`docs/REQUIREMENTS.md:L358-L363`; `.github/workflows/release-uvx.yml:L1-L48`).
