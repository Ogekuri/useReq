## Execution Units Index
- `PROC:main` â€” CLI process entrypoint for command parsing and dispatch.

## Execution Units
### `PROC:main`
- **Type**: OS process
- **Entrypoint**: `main(argv: Optional[list[str]] = None) -> int`: parse CLI args, route command execution, return exit status [`src/usereq/cli.py`]
- **Threads**: no explicit threads detected.
- **Call Trace**
  - `main(...)`: command router and execution coordinator [`src/usereq/cli.py`]
    - `parse_args(...)`: parse argv into `Namespace` [`src/usereq/cli.py`]
    - `_is_here_only_project_scan_command(...)`: detect here-only project-scan command path (`--references`, `--compress`, `--tokens`, `--find`, `--static-check`) and enforce `--base` rejection with implicit `--here` [`src/usereq/cli.py`]
    - `_is_standalone_command(...)`: detect standalone command path [`src/usereq/cli.py`]
      - `run_files_references(...)`: execute `--files-references` for explicit files [`src/usereq/cli.py`]
        - `generate_markdown(...)`: analyze files and render references markdown with relative paths [`src/usereq/generate_markdown.py`]
          - `detect_language(...)`: map extension to normalized language key [`src/usereq/generate_markdown.py`]
          - `SourceAnalyzer.analyze(...)`: extract constructs/comments per source file [`src/usereq/source_analyzer.py`]
          - `SourceAnalyzer.enrich(...)`: enrich constructs with hierarchy, body comments, and Doxygen association [`src/usereq/source_analyzer.py`]
            - `_extract_doxygen_fields(...)`: associate Doxygen comments to constructs with blocking-element/file-level safeguards [`src/usereq/source_analyzer.py`]
          - `format_markdown(...)`: render references payload for one file [`src/usereq/source_analyzer.py`]
            - `_collect_file_level_doxygen_fields(...)`: parse first `@file` block and expose file-level Doxygen fields [`src/usereq/source_analyzer.py`]
            - `_collect_element_doxygen_fields(...)`: aggregate construct-associated fields plus start-of-body docstring Doxygen tags [`src/usereq/source_analyzer.py`]
            - `format_doxygen_fields_as_markdown(...)`: emit one markdown bullet per Doxygen field occurrence using original `@tag` tokens in fixed tag order [`src/usereq/doxygen_parser.py`]
      - `run_files_find(...)`: execute `--files-find` for explicit files [`src/usereq/cli.py`]
        - `find_constructs_in_files(...)`: filter constructs by tag/name regex and render find payload [`src/usereq/find_constructs.py`]
          - `parse_tag_filter(...)`: normalize pipe-separated TAG filter [`src/usereq/find_constructs.py`]
          - `language_supports_tags(...)`: validate TAG support for the current language [`src/usereq/find_constructs.py`]
          - `SourceAnalyzer.analyze(...)`: parse constructs/comments in target file [`src/usereq/source_analyzer.py`]
          - `SourceAnalyzer.enrich(...)`: attach hierarchy/body comments and Doxygen fields [`src/usereq/source_analyzer.py`]
            - `_extract_doxygen_fields(...)`: resolve nearest valid Doxygen comment per construct [`src/usereq/source_analyzer.py`]
          - `_extract_file_level_doxygen_fields(...)`: extract file-level Doxygen metadata from `@file` block [`src/usereq/find_constructs.py`]
            - `parse_doxygen_comment(...)`: parse normalized tag->values mapping [`src/usereq/doxygen_parser.py`]
            - `format_doxygen_fields_as_markdown(...)`: render file-level bullets preserving occurrence multiplicity and original `@tag` tokens [`src/usereq/doxygen_parser.py`]
          - `format_construct(...)`: render one construct block (`> Signature` optional, `> Lines`, Doxygen, code fence) [`src/usereq/find_constructs.py`]
            - `_extract_construct_doxygen_fields(...)`: aggregate direct fields plus start-of-body docstring fields [`src/usereq/find_constructs.py`]
              - `parse_doxygen_comment(...)`: parse body comment Doxygen tags [`src/usereq/doxygen_parser.py`]
              - `format_doxygen_fields_as_markdown(...)`: render per-occurrence Doxygen bullets in canonical order with original `@tag` tokens [`src/usereq/doxygen_parser.py`]
            - `_strip_construct_comments(...)`: strip non-doc comments from extracted code slice [`src/usereq/find_constructs.py`]
              - `compress_source(...)`: language-aware comment stripping while preserving strings [`src/usereq/compress.py`]
      - `run_files_static_check_cmd(...)`: execute static checks on explicit file list [`src/usereq/cli.py`]
        - `load_static_check_from_config(...)`: load per-language static-check arrays from `.req/config.json` [`src/usereq/cli.py`]
        - `dispatch_static_check_for_file(...)`: run one configured static-check entry for one file [`src/usereq/static_check.py`]
          - `StaticCheckBase.run(...)`: iterate resolved files and aggregate result code [`src/usereq/static_check.py`]
            - `StaticCheckBase._check_file(...)` / subclass override: emit header/result or FAIL evidence per file [`src/usereq/static_check.py`]
              - `StaticCheckBase._emit_line(...)`: emit markdown lines with per-line newline termination and append one blank separator line after each file block [`src/usereq/static_check.py`]
    - `_is_project_scan_command(...)`: detect project-scan command path [`src/usereq/cli.py`]
      - `run_references(...)`: execute `--references` on collected project source files [`src/usereq/cli.py`]
        - `_resolve_project_src_dirs(...)`: resolve project base and effective source directories from `.req/config.json` [`src/usereq/cli.py`]
        - `_collect_source_files(...)`: collect source files from `git ls-files --cached --others --exclude-standard` filtered by `src-dir`, `SUPPORTED_EXTENSIONS`, and `EXCLUDED_DIRS` [`src/usereq/cli.py`]
        - `generate_markdown(...)`: render references markdown for collected files [`src/usereq/generate_markdown.py`]
          - `SourceAnalyzer.analyze(...)`: parse source constructs/comments [`src/usereq/source_analyzer.py`]
          - `SourceAnalyzer.enrich(...)`: compute Doxygen fields/hierarchy/body metadata [`src/usereq/source_analyzer.py`]
            - `_extract_doxygen_fields(...)`: enforce construct-to-comment association invariants [`src/usereq/source_analyzer.py`]
          - `format_markdown(...)`: emit references with construct/file-level Doxygen bullets [`src/usereq/source_analyzer.py`]
            - `_collect_file_level_doxygen_fields(...)`: read first `@file` documentation block [`src/usereq/source_analyzer.py`]
            - `_collect_element_doxygen_fields(...)`: merge direct and start-of-body docstring Doxygen fields [`src/usereq/source_analyzer.py`]
            - `format_doxygen_fields_as_markdown(...)`: render ordered one-line-per-occurrence fields using original `@tag` tokens [`src/usereq/doxygen_parser.py`]
      - `run_find(...)`: execute `--find` on collected project source files [`src/usereq/cli.py`]
        - `_resolve_project_src_dirs(...)`: resolve project base and source directories from `.req/config.json` [`src/usereq/cli.py`]
        - `_collect_source_files(...)`: collect candidate source files from `git ls-files` scoped to configured `src-dir` [`src/usereq/cli.py`]
        - `find_constructs_in_files(...)`: perform TAG/name filtered extraction over project files [`src/usereq/find_constructs.py`]
          - `_extract_file_level_doxygen_fields(...)`: emit file-level Doxygen bullets from `@file` comment [`src/usereq/find_constructs.py`]
          - `format_construct(...)`: render construct blocks with `> Signature`/`> Lines` metadata, Doxygen bullets, and stripped code [`src/usereq/find_constructs.py`]
            - `_extract_construct_doxygen_fields(...)`: aggregate construct-level fields and start-of-body docstrings [`src/usereq/find_constructs.py`]
            - `format_doxygen_fields_as_markdown(...)`: render ordered bullet fields without collapsing repeated tags and without label conversion [`src/usereq/doxygen_parser.py`]
      - `run_tokens(...)`: execute `--tokens` on direct files under configured `docs-dir` [`src/usereq/cli.py`]
        - `_resolve_project_base(...)`: resolve project base in here-mode (implicit for project-scan commands) [`src/usereq/cli.py`]
        - `load_config(...)`: load `docs-dir` from `.req/config.json` [`src/usereq/cli.py`]
        - `ensure_doc_directory(...)`: validate docs directory exists relative to project base [`src/usereq/cli.py`]
        - `run_files_tokens(...)`: count token/char metrics and print pack summary [`src/usereq/cli.py`]
          - `count_files_metrics(...)`: compute per-file token/char metrics [`src/usereq/token_counter.py`]
          - `format_pack_summary(...)`: render summary output to stdout [`src/usereq/token_counter.py`]
      - `run_project_static_check_cmd(...)`: execute static checks on collected project source files [`src/usereq/cli.py`]
        - `_resolve_project_src_dirs(...)`: resolve project base and effective source dirs from `.req/config.json` [`src/usereq/cli.py`]
        - `_collect_source_files(...)`: collect files from `git ls-files` output with extension/exclusion filters [`src/usereq/cli.py`]
        - `load_static_check_from_config(...)`: load per-language static-check arrays from `.req/config.json` [`src/usereq/cli.py`]
        - `dispatch_static_check_for_file(...)`: run one configured static-check entry for one file [`src/usereq/static_check.py`]
          - `StaticCheckBase.run(...)`: iterate resolved files and aggregate result code [`src/usereq/static_check.py`]
            - `StaticCheckBase._check_file(...)` / subclass override: emit header/result or FAIL evidence per file [`src/usereq/static_check.py`]
              - `StaticCheckBase._emit_line(...)`: emit markdown lines with per-line newline termination and append one blank separator line after each file block [`src/usereq/static_check.py`]
      - `run(...)`: install/update flow including `--update` persisted-flag merge, `--enable-static-check` parsing, `req-*` artifact filename emission for prompt/agent outputs, and config persistence [`src/usereq/cli.py`]
      - `load_persisted_update_flags(...)`: on `--update` (including `--here --update`), load persisted boolean install/update flags from `.req/config.json` and validate provider/artifact activation invariants [`src/usereq/cli.py`]
      - `load_centralized_models(...)`: load provider prompt metadata from `models.json` / `models-legacy.json`, including `readme` entries aligned to `write` model/mode where `write.model` is defined [`src/usereq/cli.py`]
      - `parse_enable_static_check(...)`: parse one SPEC into one static-check entry object [`src/usereq/static_check.py`]
      - `_validate_enable_static_check_command_executables(...)`: in non-update/non-config-loaded init flow, reject Command `cmd` values not resolvable as local executables before persisting `.req/config.json` [`src/usereq/cli.py`]
      - `build_persisted_update_flags(...)`: collect current boolean flag state for persistence in `.req/config.json` [`src/usereq/cli.py`]
      - `save_config(...)`: persist paths, static-check arrays, and persisted boolean flags to `.req/config.json` [`src/usereq/cli.py`]
      - `list_docs_templates(...)`: enumerate package `resources/docs` files for runtime template propagation [`src/usereq/cli.py`]
      - `find_requirements_template(...)`: validate `Requirements_Template.md` presence for runtime docs propagation under `.req/docs` [`src/usereq/cli.py`]

## Communication Edges
- None across execution units.
- Internal data handoff only within `PROC:main` stack frames (argv, parsed config objects, per-file static-check entry objects).
